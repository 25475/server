// ========================================
// SCHEMA PRISMA ADAPTADO PARA MySQL
// ========================================
// Migrado desde PostgreSQL
// Fecha: 20 de diciembre, 2025
// 
// CAMBIOS PRINCIPALES:
// - Provider cambiado a "mysql"
// - ENUMs convertidos a String (validación en backend)
// - Arrays (String[]) convertidos a Json
// - UUIDs mantenidos como VARCHAR(36)
// ========================================

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ========================================
// ENUMS ORIGINALES (AHORA COMO COMENTARIOS)
// ========================================
// Estos valores deben ser validados manualmente en el backend

// enum ProductType {
//   VIZION
//   NOVATEK
// }
// Valores válidos: "VIZION", "NOVATEK"

// enum PlanCategory {
//   HOGAR
//   GAMER
//   EMPRESARIAL
// }
// Valores válidos: "HOGAR", "GAMER", "EMPRESARIAL"

// enum EstadoOrden {
//   APROBADA
//   PENDIENTE
//   RECHAZADA
// }
// Valores válidos: "APROBADA", "PENDIENTE", "RECHAZADA"

// enum CarouselSection {
//   PRINCIPAL
//   NOSOTROS
//   PLANES
//   VISION
//   NOVATEK
//   DOMOTICA
// }
// Valores válidos: "PRINCIPAL", "NOSOTROS", "PLANES", "VISION", "NOVATEK", "DOMOTICA"

// enum CarouselType {
//   INTERNET
//   VIZION
//   DOMOTICA
//   NOVATEK
// }
// Valores válidos: "INTERNET", "VIZION", "DOMOTICA", "NOVATEK"

// ========================================
// MODELOS
// ========================================

// Modelo para categorías
model Category {
  id          String    @id @default(uuid()) @db.VarChar(36)
  name        String    @db.VarChar(255)
  slug        String    @unique @db.VarChar(255)
  description String?   @db.Text
  productType String    @db.VarChar(50)  // Era: ProductType enum
  imageUrl    String?   @db.VarChar(500)
  status      String    @default("activo") @db.VarChar(50)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]

  @@map("categories")
  @@index([productType])
}

// Modelo para productos
model Product {
  id          String   @id @default(uuid()) @db.VarChar(36)
  name        String   @db.VarChar(255)
  slug        String   @unique @db.VarChar(255)
  description String   @db.Text
  price       Float?
  imageUrl    String?  @db.VarChar(500)
  features    Json?    // Para almacenar características específicas del producto
  stock       Int?     @default(0)
  categoryId  String   @db.VarChar(36)
  category    Category @relation(fields: [categoryId], references: [id])
  productType String   @db.VarChar(50)  // Era: ProductType enum
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("products")
  @@index([categoryId])
  @@index([productType])
}

// Modelo para planes
model Plan {
  id          String   @id @default(uuid()) @db.VarChar(36)
  name        String   @db.VarChar(255)
  description String   @db.Text
  price       Float
  imageUrl    String?  @db.VarChar(500)
  features    Json     @default("[]")  // Era: String[] array → ahora JSON: ["feat1", "feat2"]
  category    String   @default("HOGAR") @db.VarChar(50)  // Era: PlanCategory enum
  isPopular   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("plans")
  @@index([category])
}

// Modelo para usuarios administradores
model Admin {
  id        String   @id @default(uuid()) @db.VarChar(36)
  email     String   @unique @db.VarChar(255)
  password  String   @db.VarChar(255)
  name      String   @db.VarChar(255)
  role      String   @default("admin") @db.VarChar(50)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

// Modelo para órdenes de compra
model Order {
  id            String      @id @default(uuid()) @db.VarChar(36)
  customerName  String      @db.VarChar(255)
  customerEmail String      @db.VarChar(255)
  customerPhone String?     @db.VarChar(50)
  address       String      @db.Text
  reference     String?     @db.VarChar(255)
  total         Float
  status        String      @default("PENDING") @db.VarChar(50)
  paymentMethod String?     @db.VarChar(100)
  transactionId String?     @db.VarChar(255)
  items         OrderItem[]
  pdfUrl        String?     @db.VarChar(500)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@map("orders")
  @@index([status])
}

model OrderItem {
  id          String  @id @default(uuid()) @db.VarChar(36)
  orderId     String  @db.VarChar(36)
  order       Order   @relation(fields: [orderId], references: [id])
  productId   String  @db.VarChar(36)
  productName String  @db.VarChar(255)
  price       Float
  quantity    Int

  @@map("order_items")
  @@index([orderId])
}

// Modelo para órdenes generadas desde el frontend
model Orden {
  id            String   @id @default(uuid()) @db.VarChar(36)
  orderId       String?  @unique @db.VarChar(50)  // Formato: ORD-00001, ORD-00002, etc.
  nombreCliente String   @db.VarChar(255)
  telefono      String   @db.VarChar(50)
  productos     Json     // Array de productos en formato JSON
  total         Float
  pdfUrl        String   @db.VarChar(500)
  fecha         DateTime @default(now())
  createdAt     DateTime @default(now())
  estado        String   @default("PENDIENTE") @db.VarChar(50)  // Era: EstadoOrden enum

  @@map("ordenes")
  @@index([estado])
}

// Modelo para links de interés en el footer
model InterestLink {
  id        String   @id @default(cuid()) @db.VarChar(36)
  title     String   @db.VarChar(255)  // Texto visible para el usuario
  url       String   @db.VarChar(500)  // URL real del link
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("interest_links")
}

// Modelo para imágenes de carruseles
model CarouselImage {
  id        String   @id @default(uuid()) @db.VarChar(36)
  section   String   @db.VarChar(50)  // Era: CarouselSection enum
  type      String?  @db.VarChar(50)  // Era: CarouselType enum (Solo para PRINCIPAL, null para otras secciones)
  url       String   @db.VarChar(500) // URL de la imagen (generada por IA después)
  order     Int      // Orden de display en el carrusel (1, 2, 3, 4...)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("carousel_images")
  @@index([section])
  @@index([section, order])
}

// Modelo para videos de secciones
model Video {
  id          String   @id @default(uuid()) @db.VarChar(36)
  url         String   @db.VarChar(500)
  section     String   @db.VarChar(50)
  title       String?  @db.VarChar(255)
  description String?  @db.Text
  status      String   @default("activo") @db.VarChar(50)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("videos")
  @@index([section])
}
